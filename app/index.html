<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>XSS Level 2</title>
    <!-- Internal game scripts/styles, mostly boring stuff -->
    <script src="static/game-frame.js"></script>
    <link rel="stylesheet" href="static/game-frame-styles.css" />

    <!-- This is our database of messages -->
    <script src="static/post-store.js"></script>

    <script>
        var defaultMessage = "Welcome!<br><br>This is your <i>personal</i>" +
            " stream. You can post anything you want here, especially " +
            "<span style='color: #f00ba7'>madness</span>.";

        var DB = new PostDB(defaultMessage);

        function displayPosts() {
            var containerEl = document.getElementById("post-container");
            containerEl.innerHTML = "";

            var posts = DB.getPosts();
            for (var i = 0; i < posts.length; i++) {
                var html = '<table class="message"> <tr> <td valign=top> ' +
                    '<img width="50" height="50" src="static/hello.gif"> </td> <td valign=top ' +
                    ' class="message-container"> <div class="shim"></div>';

                html += '<b>You</b>';
                html += '<span class="date">' + new Date(posts[i].date) + '</span>';
                html += "<blockquote>" + posts[i].message + "</blockquote";
                html += "</td></tr></table>"
                containerEl.innerHTML += html;
            }
        }

        window.onload = function() {
            document.getElementById('clear-form').onclick = function() {
                DB.clear(function() {
                    displayPosts()
                });
                return false;
            }

            document.getElementById('submit-form').onclick = function() {
                console.log("btn clicked")
                var message = document.getElementById('post-content').value;
                DB.save(message, function() {
                    displayPosts()
                });
                document.getElementById('post-content').value = "";
                return false;
            }

            displayPosts();
        }
    </script>
</head>

<body id="level2">
    <div id="header">
        <img width="150" height="35" src="static/DP.png" />
        <div>Chat room.</div>
        <button class="clear" id="clear-form">Clear all posts</button>
    </div>

    <div id="post-container"></div>

    <table class="message">
        <tr>
            <td valign="top">
                <img width="50" height="50" src="static/hello.gif">
            </td>
            <td class="message-container">
                <div class="shim"></div>
                <form id="post-form" name="chat-room">
                    <textarea id="post-content" name="content" rows="2" cols="50"></textarea>
                    <button id="submit-form" class="share">send</button>
                </form>
            </td>
        </tr>
    </table>

</body>

</html>